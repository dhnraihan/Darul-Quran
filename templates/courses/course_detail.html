{% extends 'base.html' %}
{% load i18n %}

{% block title %}{{ course.title }} - Amar Quran{% endblock %}

{% block extra_css %}
<style>
    .syllabus-item {
        transition: all 0.3s ease;
    }
    .syllabus-item:hover {
        background-color: #f9fafb;
    }
    .video-thumbnail {
        position: relative;
        overflow: hidden;
    }
    .video-thumbnail:hover .play-overlay {
        opacity: 1;
    }
    .play-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.7);
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        transition: opacity 0.3s;
    }
</style>
{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 py-8">
    <!-- Course Header -->
    <div class="bg-gradient-to-r from-green-600 to-green-700 text-white rounded-lg shadow-lg p-8 mb-8">
        <div class="grid md:grid-cols-3 gap-8">
            <div class="md:col-span-2">
                <!-- Breadcrumb -->
                <nav class="text-green-100 text-sm mb-4">
                    <a href="{% url 'home' %}" class="hover:text-white">{% trans "Home" %}</a>
                    <span class="mx-2">/</span>
                    <a href="{% url 'courses:list' %}" class="hover:text-white">{% trans "Courses" %}</a>
                    <span class="mx-2">/</span>
                    <span>{{ course.category.name }}</span>
                </nav>

                <h1 class="text-3xl md:text-4xl font-bold mb-4">
                    {% if request.LANGUAGE_CODE == 'bn' and course.title_bn %}
                        {{ course.title_bn }}
                    {% else %}
                        {{ course.title }}
                    {% endif %}
                </h1>
                
                <p class="text-lg text-green-50 mb-6">
                    {% if request.LANGUAGE_CODE == 'bn' and course.description_bn %}
                        {{ course.description_bn|truncatewords:30 }}
                    {% else %}
                        {{ course.description|truncatewords:30 }}
                    {% endif %}
                </p>

                <!-- Course Meta Info -->
                <div class="flex flex-wrap gap-4 text-sm">
                    <div class="flex items-center">
                        <i class="fas fa-star text-yellow-400 mr-1"></i>
                        <span class="font-semibold">{{ avg_rating|floatformat:1 }}</span>
                        <span class="text-green-100 ml-1">({{ total_reviews }} {% trans "reviews" %})</span>
                    </div>
                    <div class="flex items-center">
                        <i class="fas fa-users mr-2"></i>
                        <span>{{ course.enrollments.count }} {% trans "students enrolled" %}</span>
                    </div>
                    <div class="flex items-center">
                        <i class="fas fa-language mr-2"></i>
                        <span>{% trans "Bengali & English" %}</span>
                    </div>
                    <div class="flex items-center">
                        <i class="fas fa-certificate mr-2"></i>
                        <span>{% trans "Certificate of Completion" %}</span>
                    </div>
                </div>

                <!-- Instructor Info -->
                {% if course.teachers.exists %}
                <div class="mt-6 flex items-center">
                    <span class="text-green-100 mr-3">{% trans "Taught by:" %}</span>
                    {% for teacher in course.teachers.all|slice:":3" %}
                        <div class="flex items-center mr-4">
                            {% if teacher.profile_picture %}
                                <img src="{{ teacher.profile_picture.url }}" alt="{{ teacher.get_full_name }}" 
                                     class="w-10 h-10 rounded-full border-2 border-white mr-2">
                            {% else %}
                                <div class="w-10 h-10 rounded-full bg-white/20 flex items-center justify-center mr-2">
                                    <i class="fas fa-user text-sm"></i>
                                </div>
                            {% endif %}
                            <span class="font-medium">{{ teacher.get_full_name }}</span>
                        </div>
                    {% endfor %}
                </div>
                {% endif %}
            </div>

            <!-- Course Card -->
            <div class="md:row-span-2">
                <div class="bg-white rounded-lg shadow-xl overflow-hidden">
                    {% if course.thumbnail %}
                        <img src="{{ course.thumbnail.url }}" alt="{{ course.title }}" 
                             class="w-full h-48 object-cover">
                    {% else %}
                        <div class="w-full h-48 bg-gradient-to-br from-green-400 to-green-600 flex items-center justify-center">
                            <i class="fas fa-book-quran text-white text-5xl"></i>
                        </div>
                    {% endif %}
                    
                    <div class="p-6">
                        <!-- Price -->
                        <div class="mb-4">
                            {% if course.is_free %}
                                <p class="text-3xl font-bold text-green-600">{% trans "Free" %}</p>
                            {% else %}
                                {% if course.discount_price %}
                                    <p class="text-3xl font-bold text-gray-800">৳{{ course.discount_price }}</p>
                                    <p class="text-lg text-gray-400 line-through">৳{{ course.price }}</p>
                                    <p class="text-sm text-green-600">
                                        {% widthratio course.discount_price course.price -100 as discount %}
                                        {{ discount|add:100 }}% {% trans "OFF" %}
                                    </p>
                                {% else %}
                                    <p class="text-3xl font-bold text-gray-800">৳{{ course.price }}</p>
                                {% endif %}
                            {% endif %}
                        </div>

                        <!-- Action Buttons -->
                        {% if is_enrolled %}
                            <a href="{% url 'courses:content' course.slug %}" 
                               class="w-full bg-green-600 text-white py-3 rounded-lg font-semibold hover:bg-green-700 transition block text-center mb-3">
                                <i class="fas fa-play mr-2"></i>{% trans "Continue Learning" %}
                            </a>
                        {% else %}
                            <a href="{% url 'courses:enroll' course.slug %}" 
                               class="w-full bg-green-600 text-white py-3 rounded-lg font-semibold hover:bg-green-700 transition block text-center mb-3">
                                <i class="fas fa-shopping-cart mr-2"></i>
                                {% if course.is_free %}
                                    {% trans "Enroll Now - It's Free" %}
                                {% else %}
                                    {% trans "Enroll Now" %}
                                {% endif %}
                            </a>
                        {% endif %}

                        <!-- Trial Class Button -->
                        {% if not is_enrolled %}
                        <a href="{% url 'classes:assessment' %}?course={{ course.id }}" 
                           class="w-full bg-white text-green-600 border-2 border-green-600 py-3 rounded-lg font-semibold hover:bg-green-50 transition block text-center">
                            <i class="fas fa-calendar-check mr-2"></i>{% trans "Book Free Trial Class" %}
                        </a>
                        {% endif %}

                        <!-- Course Includes -->
                        <div class="mt-6 space-y-3">
                            <h3 class="font-semibold text-gray-800">{% trans "This course includes:" %}</h3>
                            <ul class="space-y-2 text-sm text-gray-600">
                                <li class="flex items-center">
                                    <i class="fas fa-video text-green-600 mr-3 w-4"></i>
                                    <span>{{ course.sessions_per_week }} {% trans "live sessions per week" %}</span>
                                </li>
                                <li class="flex items-center">
                                    <i class="fas fa-clock text-green-600 mr-3 w-4"></i>
                                    <span>{{ course.session_duration_minutes }} {% trans "minutes per session" %}</span>
                                </li>
                                <li class="flex items-center">
                                    <i class="fas fa-calendar-alt text-green-600 mr-3 w-4"></i>
                                    <span>{{ course.recommended_duration_weeks }} {% trans "weeks duration" %}</span>
                                </li>
                                <li class="flex items-center">
                                    <i class="fas fa-users text-green-600 mr-3 w-4"></i>
                                    <span>{% trans "One-to-one classes" %}</span>
                                </li>
                                <li class="flex items-center">
                                    <i class="fas fa-book text-green-600 mr-3 w-4"></i>
                                    <span>{% trans "Study materials included" %}</span>
                                </li>
                                <li class="flex items-center">
                                    <i class="fas fa-trophy text-green-600 mr-3 w-4"></i>
                                    <span>{% trans "Certificate on completion" %}</span>
                                </li>
                                <li class="flex items-center">
                                    <i class="fas fa-redo text-green-600 mr-3 w-4"></i>
                                    <span>{% trans "Lifetime access" %}</span>
                                </li>
                            </ul>
                        </div>

                        <!-- Share Course -->
                        <div class="mt-6 pt-6 border-t">
                            <p class="text-sm text-gray-600 mb-2">{% trans "Share this course:" %}</p>
                            <div class="flex space-x-3">
                                <a href="https://www.facebook.com/sharer/sharer.php?u={{ request.build_absolute_uri }}" 
                                   target="_blank"
                                   class="text-blue-600 hover:text-blue-700">
                                    <i class="fab fa-facebook text-xl"></i>
                                </a>
                                <a href="https://twitter.com/intent/tweet?url={{ request.build_absolute_uri }}&text={{ course.title }}" 
                                   target="_blank"
                                   class="text-blue-400 hover:text-blue-500">
                                    <i class="fab fa-twitter text-xl"></i>
                                </a>
                                <a href="https://wa.me/?text={{ course.title }} {{ request.build_absolute_uri }}" 
                                   target="_blank"
                                   class="text-green-600 hover:text-green-700">
                                    <i class="fab fa-whatsapp text-xl"></i>
                                </a>
                                <button onclick="copyLink()" class="text-gray-600 hover:text-gray-700">
                                    <i class="fas fa-link text-xl"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Course Content Tabs -->
    <div class="bg-white rounded-lg shadow-md mb-8">
        <div class="border-b">
            <nav class="flex space-x-8 px-6" aria-label="Tabs">
                <button onclick="showTab('overview')" class="tab-btn py-4 px-1 border-b-2 font-medium text-sm border-green-600 text-green-600" data-tab="overview">
                    {% trans "Overview" %}
                </button>
                <button onclick="showTab('syllabus')" class="tab-btn py-4 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="syllabus">
                    {% trans "Syllabus" %}
                </button>
                <button onclick="showTab('instructor')" class="tab-btn py-4 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="instructor">
                    {% trans "Instructor" %}
                </button>
                <button onclick="showTab('reviews')" class="tab-btn py-4 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="reviews">
                    {% trans "Reviews" %} ({{ total_reviews }})
                </button>
                <button onclick="showTab('faq')" class="tab-btn py-4 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="faq">
                    {% trans "FAQ" %}
                </button>
            </nav>
        </div>

        <!-- Tab Content -->
        <div class="p-6">
            <!-- Overview Tab -->
            <div id="overview-tab" class="tab-content">
                <h2 class="text-2xl font-bold mb-4">{% trans "Course Overview" %}</h2>
                <div class="prose max-w-none text-gray-700">
                    {% if request.LANGUAGE_CODE == 'bn' and course.description_bn %}
                        {{ course.description_bn|linebreaks }}
                    {% else %}
                        {{ course.description|linebreaks }}
                    {% endif %}
                </div>

                <!-- What You'll Learn -->
                <div class="mt-8">
                    <h3 class="text-xl font-semibold mb-4">{% trans "What you'll learn" %}</h3>
                    <div class="grid md:grid-cols-2 gap-4">
                        <div class="flex items-start">
                            <i class="fas fa-check text-green-600 mt-1 mr-3"></i>
                            <span>{% trans "Proper Qur'an recitation with Tajweed rules" %}</span>
                        </div>
                        <div class="flex items-start">
                            <i class="fas fa-check text-green-600 mt-1 mr-3"></i>
                            <span>{% trans "Understanding of Arabic pronunciation" %}</span>
                        </div>
                        <div class="flex items-start">
                            <i class="fas fa-check text-green-600 mt-1 mr-3"></i>
                            <span>{% trans "Memorization techniques for verses" %}</span>
                        </div>
                        <div class="flex items-start">
                            <i class="fas fa-check text-green-600 mt-1 mr-3"></i>
                            <span>{% trans "Islamic values and teachings" %}</span>
                        </div>
                    </div>
                </div>

                <!-- Requirements -->
                <div class="mt-8">
                    <h3 class="text-xl font-semibold mb-4">{% trans "Requirements" %}</h3>
                    <ul class="space-y-2 text-gray-700">
                        <li class="flex items-start">
                            <i class="fas fa-circle text-xs text-gray-400 mt-2 mr-3"></i>
                            <span>{% trans "Stable internet connection for live classes" %}</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fas fa-circle text-xs text-gray-400 mt-2 mr-3"></i>
                            <span>{% trans "Computer, tablet, or smartphone with camera and microphone" %}</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fas fa-circle text-xs text-gray-400 mt-2 mr-3"></i>
                            <span>{% trans "Dedication to attend regular classes" %}</span>
                        </li>
                    </ul>
                </div>

                <!-- Who This Course is For -->
                <div class="mt-8">
                    <h3 class="text-xl font-semibold mb-4">{% trans "Who this course is for" %}</h3>
                    <ul class="space-y-2 text-gray-700">
                        <li class="flex items-start">
                            <i class="fas fa-user text-green-600 mr-3 mt-1"></i>
                            <span>{% trans "Beginners who want to learn Qur'an from scratch" %}</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fas fa-user text-green-600 mr-3 mt-1"></i>
                            <span>{% trans "Students looking to improve their recitation" %}</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fas fa-user text-green-600 mr-3 mt-1"></i>
                            <span>{% trans "Anyone interested in Islamic studies" %}</span>
                        </li>
                        {% if course.age_group != 'all' %}
                        <li class="flex items-start">
                            <i class="fas fa-user text-green-600 mr-3 mt-1"></i>
                            <span>{% trans "Age group:" %} {{ course.get_age_group_display }}</span>
                        </li>
                        {% endif %}
                    </ul>
                </div>
            </div>

            <!-- Syllabus Tab -->
            <div id="syllabus-tab" class="tab-content hidden">
                <h2 class="text-2xl font-bold mb-4">{% trans "Course Syllabus" %}</h2>
                <div class="space-y-2">
                    {% for section in syllabus %}
                    <div class="syllabus-item border rounded-lg p-4">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center">
                                <div class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center mr-4">
                                    <span class="text-green-600 font-semibold">{{ forloop.counter }}</span>
                                </div>
                                <div>
                                    <h3 class="font-medium text-gray-800">{{ section }}</h3>
                                    <p class="text-sm text-gray-500">{% trans "Week" %} {{ forloop.counter }}</p>
                                </div>
                            </div>
                            <i class="fas fa-check-circle text-green-600"></i>
                        </div>
                    </div>
                    {% empty %}
                    <p class="text-gray-500">{% trans "Detailed syllabus will be provided upon enrollment." %}</p>
                    {% endfor %}
                </div>
            </div>

            <!-- Instructor Tab -->
            <div id="instructor-tab" class="tab-content hidden">
                <h2 class="text-2xl font-bold mb-4">{% trans "Your Instructors" %}</h2>
                <div class="space-y-6">
                    {% for teacher in course.teachers.all %}
                    <div class="flex items-start space-x-4 p-4 border rounded-lg">
                        {% if teacher.profile_picture %}
                            <img src="{{ teacher.profile_picture.url }}" alt="{{ teacher.get_full_name }}" 
                                 class="w-24 h-24 rounded-full">
                        {% else %}
                            <div class="w-24 h-24 rounded-full bg-gray-300 flex items-center justify-center">
                                <i class="fas fa-user text-2xl text-gray-500"></i>
                            </div>
                        {% endif %}
                        <div class="flex-1">
                            <h3 class="text-xl font-semibold">{{ teacher.get_full_name }}</h3>
                            {% if teacher.teacher_profile %}
                                <div class="flex items-center mt-1 mb-3">
                                    <div class="flex text-yellow-400">
                                        {% for i in "12345" %}
                                            {% if forloop.counter <= teacher.teacher_profile.rating %}
                                                <i class="fas fa-star text-sm"></i>
                                            {% else %}
                                                <i class="far fa-star text-sm"></i>
                                            {% endif %}
                                        {% endfor %}
                                    </div>
                                    <span class="ml-2 text-sm text-gray-600">
                                        {{ teacher.teacher_profile.rating|floatformat:1 }} 
                                        ({{ teacher.teacher_profile.total_reviews }} {% trans "reviews" %})
                                    </span>
                                </div>
                                <p class="text-gray-700 mb-3">{{ teacher.teacher_profile.bio|truncatewords:50 }}</p>
                                <div class="flex flex-wrap gap-4 text-sm text-gray-600">
                                    <span><i class="fas fa-graduation-cap mr-1"></i> {{ teacher.teacher_profile.years_of_experience }} {% trans "years experience" %}</span>
                                    <span><i class="fas fa-users mr-1"></i> {{ teacher.teaching_enrollments.count }} {% trans "students" %}</span>
                                    <span><i class="fas fa-language mr-1"></i> 
                                        {% for lang in teacher.teacher_profile.languages %}
                                            {{ lang }}{% if not forloop.last %}, {% endif %}
                                        {% endfor %}
                                    </span>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                    {% empty %}
                    <p class="text-gray-500">{% trans "Instructor information will be provided upon enrollment." %}</p>
                    {% endfor %}
                </div>
            </div>

            <!-- Reviews Tab -->
            <div id="reviews-tab" class="tab-content hidden">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold">{% trans "Student Reviews" %}</h2>
                    {% if is_enrolled %}
                    <a href="{% url 'courses:add_review' course.slug %}" 
                       class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition">
                        <i class="fas fa-plus mr-2"></i>{% trans "Write a Review" %}
                    </a>
                    {% endif %}
                </div>

                <!-- Rating Summary -->
                <div class="grid md:grid-cols-3 gap-8 mb-8">
                    <div class="text-center">
                        <p class="text-5xl font-bold text-gray-800">{{ avg_rating|floatformat:1 }}</p>
                        <div class="flex justify-center text-yellow-400 my-2">
                            {% for i in "12345" %}
                                {% if forloop.counter <= avg_rating %}
                                    <i class="fas fa-star"></i>
                                {% else %}
                                    <i class="far fa-star"></i>
                                {% endif %}
                            {% endfor %}
                        </div>
                        <p class="text-gray-600">{{ total_reviews }} {% trans "reviews" %}</p>
                    </div>
                    
                    <div class="md:col-span-2">
                        <!-- Rating Bars -->
                        {% for i in "54321" %}
                        <div class="flex items-center mb-2">
                            <span class="text-sm text-gray-600 w-12">{{ i }} ⭐</span>
                            <div class="flex-1 mx-3 bg-gray-200 rounded-full h-2">
                                <div class="bg-yellow-400 h-2 rounded-full" style="width: {% widthratio reviews|length total_reviews 100 %}%"></div>
                            </div>
                            <span class="text-sm text-gray-600 w-12">0</span>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <!-- Individual Reviews -->
                <div class="space-y-6">
                    {% for review in reviews %}
                    <div class="border-b pb-6">
                        <div class="flex items-start">
                            {% if review.student.profile_picture %}
                                <img src="{{ review.student.profile_picture.url }}" alt="{{ review.student.get_full_name }}" 
                                     class="w-12 h-12 rounded-full mr-4">
                            {% else %}
                                <div class="w-12 h-12 rounded-full bg-gray-300 flex items-center justify-center mr-4">
                                    <i class="fas fa-user text-gray-500"></i>
                                </div>
                            {% endif %}
                            <div class="flex-1">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h4 class="font-semibold">{{ review.student.get_full_name }}</h4>
                                        <div class="flex items-center mt-1">
                                            <div class="flex text-yellow-400">
                                                {% for i in "12345" %}
                                                    {% if forloop.counter <= review.rating %}
                                                        <i class="fas fa-star text-sm"></i>
                                                    {% else %}
                                                        <i class="far fa-star text-sm"></i>
                                                    {% endif %}
                                                {% endfor %}
                                            </div>
                                            <span class="ml-2 text-sm text-gray-500">{{ review.created_at|timesince }} {% trans "ago" %}</span>
                                        </div>
                                    </div>
                                    {% if review.is_verified_purchase %}
                                    <span class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded">
                                        <i class="fas fa-check-circle mr-1"></i>{% trans "Verified Purchase" %}
                                    </span>
                                    {% endif %}
                                </div>
                                <h5 class="font-medium mt-3">{{ review.title }}</h5>
                                <p class="text-gray-700 mt-2">{{ review.comment }}</p>
                            </div>
                        </div>
                    </div>
                    {% empty %}
                    <p class="text-center text-gray-500 py-8">{% trans "No reviews yet. Be the first to review this course!" %}</p>
                    {% endfor %}
                </div>

                {% if reviews.count > 5 %}
                <div class="text-center mt-6">
                    <button class="text-green-600 hover:text-green-700 font-medium">
                        {% trans "Show More Reviews" %} <i class="fas fa-chevron-down ml-1"></i>
                    </button>
                </div>
                {% endif %}
            </div>

            <!-- FAQ Tab -->
            <div id="faq-tab" class="tab-content hidden">
                <h2 class="text-2xl font-bold mb-4">{% trans "Frequently Asked Questions" %}</h2>
                <div class="space-y-4">
                    <details class="border rounded-lg p-4">
                        <summary class="font-medium cursor-pointer">{% trans "How do the live classes work?" %}</summary>
                        <p class="mt-3 text-gray-700">
                            {% trans "Classes are conducted one-to-one via video conferencing platforms like Teams, Zoom, or WhatsApp. You'll receive a meeting link before each session." %}
                        </p>
                    </details>
                    
                    <details class="border rounded-lg p-4">
                        <summary class="font-medium cursor-pointer">{% trans "What if I miss a class?" %}</summary>
                        <p class="mt-3 text-gray-700">
                            {% trans "You can reschedule missed classes with your teacher. We also provide recorded sessions when possible." %}
                        </p>
                    </details>
                    
                    <details class="border rounded-lg p-4">
                        <summary class="font-medium cursor-pointer">{% trans "Do I get a certificate?" %}</summary>
                        <p class="mt-3 text-gray-700">
                            {% trans "Yes, you'll receive a certificate of completion after successfully finishing the course and passing the assessment." %}
                        </p>
                    </details>
                    
                    <details class="border rounded-lg p-4">
                        <summary class="font-medium cursor-pointer">{% trans "Can I change my teacher?" %}</summary>
                        <p class="mt-3 text-gray-700">
                            {% trans "Yes, you can request to change your teacher if needed. Contact our support team for assistance." %}
                        </p>
                    </details>
                    
                    <details class="border rounded-lg p-4">
                        <summary class="font-medium cursor-pointer">{% trans "What payment methods are accepted?" %}</summary>
                        <p class="mt-3 text-gray-700">
                            {% trans "We accept bKash, Nagad, Rocket for local payments and Stripe for international cards." %}
                        </p>
                    </details>
                </div>
            </div>
        </div>
    </div>

    <!-- Free Preview Videos -->
    {% if free_videos %}
    <div class="bg-white rounded-lg shadow-md mb-8 p-6">
        <h2 class="text-2xl font-bold mb-4">{% trans "Free Preview" %}</h2>
        <div class="grid md:grid-cols-3 gap-4">
            {% for video in free_videos %}
            <div class="video-thumbnail rounded-lg overflow-hidden cursor-pointer" onclick="playVideo('{{ video.video_url }}')">
                <img src="https://img.youtube.com/vi/{{ video.video_url|slice:"-11:" }}/mqdefault.jpg" 
                     alt="{{ video.title }}" class="w-full">
                <div class="play-overlay">
                    <i class="fas fa-play-circle text-white text-5xl"></i>
                </div>
                <div class="p-3">
                    <h4 class="font-medium text-sm">{{ video.title }}</h4>
                    <p class="text-xs text-gray-500">{{ video.duration_minutes }} {% trans "minutes" %}</p>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- Related Courses -->
    <div class="mt-8">
        <h2 class="text-2xl font-bold mb-4">{% trans "Related Courses" %}</h2>
        <div class="grid md:grid-cols-4 gap-4">
            {% for related in related_courses %}
            <a href="{% url 'courses:detail' related.slug %}" class="bg-white rounded-lg shadow hover:shadow-lg transition">
                {% if related.thumbnail %}
                    <img src="{{ related.thumbnail.url }}" alt="{{ related.title }}" 
                         class="w-full h-32 object-cover rounded-t-lg">
                {% else %}
                    <div class="w-full h-32 bg-gradient-to-r from-green-400 to-green-500 rounded-t-lg"></div>
                {% endif %}
                <div class="p-4">
                    <h3 class="font-medium text-sm mb-1">{{ related.title }}</h3>
                    <p class="text-green-600 font-semibold">
                        {% if related.is_free %}
                            {% trans "Free" %}
                        {% else %}
                            ৳{{ related.current_price }}
                        {% endif %}
                    </p>
                </div>
            </a>
            {% endfor %}
        </div>
    </div>
</div>

<!-- Video Modal -->
<div id="videoModal" class="fixed inset-0 bg-black bg-opacity-75 hidden z-50 flex items-center justify-center">
    <div class="relative max-w-4xl w-full mx-4">
        <button onclick="closeVideo()" class="absolute -top-10 right-0 text-white text-2xl">
            <i class="fas fa-times"></i>
        </button>
        <div class="relative pb-[56.25%]">
            <iframe id="videoFrame" class="absolute top-0 left-0 w-full h-full" 
                    frameborder="0" allowfullscreen></iframe>
        </div>
    </div>
</div>

<script>
    // Tab functionality
    function showTab(tabName) {
        // Hide all tabs
        document.querySelectorAll('.tab-content').forEach(tab => {
            tab.classList.add('hidden');
        });
        
        // Remove active state from all buttons
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.classList.remove('border-green-600', 'text-green-600');
            btn.classList.add('border-transparent', 'text-gray-500');
        });
        
        // Show selected tab
        document.getElementById(tabName + '-tab').classList.remove('hidden');
        
        // Add active state to clicked button
        const activeBtn = document.querySelector(`[data-tab="${tabName}"]`);
        activeBtn.classList.remove('border-transparent', 'text-gray-500');
        activeBtn.classList.add('border-green-600', 'text-green-600');
    }
    
    // Copy link functionality
    function copyLink() {
        navigator.clipboard.writeText(window.location.href);
        alert('{% trans "Link copied to clipboard!" %}');
    }
    
    // Video modal
    function playVideo(url) {
        document.getElementById('videoModal').classList.remove('hidden');
        document.getElementById('videoFrame').src = url + '?autoplay=1';
    }
    
    function closeVideo() {
        document.getElementById('videoModal').classList.add('hidden');
        document.getElementById('videoFrame').src = '';
    }
</script>
{% endblock %}